<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Wheel of Fortune</title>
    <style>
        :root {
            --background-color: #ffffff; /* –ù–µ–∂–Ω–æ –≥–æ–ª—É–±–æ–π —Ü–≤–µ—Ç */
            --container-bg-color: #b2ebf2; /* –ù–µ–∂–Ω–æ –≥–æ–ª—É–±–æ–π —Ü–≤–µ—Ç */
            --text-color: #000000; /* –ß–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
            --result-box-bg: rgba(255, 255, 255, 0.8); /* –ë–µ–ª—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ü–≤–µ—Ç */
        }

        [data-theme="dark"] {
            --background-color: #121212;
            --container-bg-color: #b2ebf2; /* –ù–µ–∂–Ω–æ –≥–æ–ª—É–±–æ–π —Ü–≤–µ—Ç */
            --text-color: #000000; /* –ß–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
            --result-box-bg: rgba(255, 255, 255, 0.8); /* –ë–µ–ª—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ü–≤–µ—Ç */
        }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            width: calc(100% - 20px);
            height: auto;
            max-width: 600px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            background-color: var(--container-bg-color);
            padding: 20px;
            margin: 10px 0 0 0;
            box-sizing: border-box;
        }

        .wheel {
            position: relative;
            width: 100%;
            max-width: 500px;
            flex-shrink: 0;
        }

        #canvas {
            width: 100%;
            height: auto;
        }

        #pointer {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50px;
            height: 50px;
            background-color: #FFD700;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 2;
            border: 5px solid white;
        }

        #triangle {
            position: absolute;
            top: calc(50% - 45px);
            left: 50%;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 30px solid white;
            transform: translateX(-50%);
            z-index: 1;
        }

        #spinButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #006400;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        #spinButton:hover {
            background-color: #004d00;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        #spinButton:disabled {
            background-color: #999;
            cursor: not-allowed;
        }

        #resultBox {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 10px;
            background-color: var(--result-box-bg);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 80%;
            max-width: 300px;
            text-align: center;
            font-size: 18px;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3;
            color: var(--text-color); /* –ß–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        <div class="wheel">
            <canvas id="canvas" width="500" height="500"></canvas>
            <div id="triangle"></div>
            <div id="pointer"></div>
            <div id="resultBox">–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –∑–¥–µ—Å—å</div>
        </div>
        <button id="spinButton">–í—Ä–∞—â–∞—Ç—å –∫–æ–ª–µ—Å–æ!</button>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const tg = window.Telegram.WebApp;
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const segments = ['üéÅ', 'üéâ', 'üéä', 'üéà', 'üéÇ', 'üéÑ', 'üéÖ', 'üéÜ', 'üéá', 'üéç'];
            const descriptions = [
                '–°–∫–∏–¥–∫–∞ 50 % –Ω–∞ –ª—é–±—É—é –∏–∑ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥ –∞ –∏–º–µ–Ω–Ω–æ —á–∏—Å—Ç–∫–∞ –±–æ—Ç–æ–≤, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è, –∑–∞—â–∏—Ç–∞ –∞–∫–∫–∞—É–Ω—Ç–∞',
                '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–æ—Ü —Å–µ—Ç–µ–π –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–≤ –Ω–∞ –≤—ã–±–æ—Ä –≤–æ—Ç –∞–ø–ø, –∏–Ω—Å—Ç–∞–≥—Ä–∞–º, —Ç–µ–ª–µ–≥—Ä–∞–º–º',
                '–°–∫–∏–¥–∫–∞ 20 % –Ω–∞ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ inhelpsta',
                '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —É –∫–æ—É—á–∞-–ø—Å–∏—Ö–æ–ª–æ–≥–∞',
                '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ 10000 —Ä—É–±–ª–µ–π –Ω–∞ –ª—é–±—É—é –∏–∑ –Ω–∞—à–∏—Ö —É—Å–ª—É–≥ (—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±–µ—Å—Å—Ä–æ—á–Ω—ã–π –ø–æ –∂–µ–ª–∞–Ω–∏—é –º–æ–∂–µ—Ç–µ —É –Ω–∞—Å –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ –µ–≥–æ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫)',
                '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —á–∏—Å—Ç–∫–∞ –≤–∞—à–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ ( –¥–ª—è —á–∏—Å—Ç–∫–∏ –Ω—É–∂–µ–Ω –±—É–¥–µ—Ç –≤–∞—à —Ç–µ–ª–µ–≥—Ä–∞–º–º –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –≤—Ö–æ–¥–∞ ) –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–µ–ª–æ–≤–µ–∫–µ –Ω–µ–ª—å–∑—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –Ω–æ –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –µ–µ –æ—Ç –Ω–µ–¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª–µ–π',
                '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —á–∏—Å—Ç–∫–∞ –≤ –∏–Ω—Å—Ç –¥–æ 1000 –±–æ—Ç–æ–≤ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–æ –ø—Ä–∞–π—Å—É —Å–æ —Å–∫–∏–¥–∫–æ–π 20 %',
                '–°–∫–∏–¥–∫–∞ –Ω–∞ —É—Å–ª—É–≥—É –∑–∞—â–∏—Ç–∞ 30 %  ( –µ—Å–ª–∏ –±–µ—Ä–µ—Ç–µ —Ç–∞—Ä–∏—Ñ –Ω–∞ –≥–æ–¥ )',
                '–ì–∞–π–¥ –ø–æ –∞–≤—Ç–æ—Ä—Å–∫–æ–º—É –ø—Ä–∞–≤—É –≤ –∏–Ω—Å—Ç–∞–≥—Ä–∞–º (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ç–µ—Ö –∫—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –ø—Ä–æ–¥–∞–∂–µ–π –±—Ä–µ–Ω–¥–æ–≤ –≤ —Å–æ—Ü —Å–µ—Ç—è—Ö)',
                '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —ç–∫—Å–ø—Ä–µ—Å—Å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∏ —Å–∫–∏–¥–∫–∞ –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –ø–æ –≤–æ—Ü –∞–ø–ø –∏–Ω—Å—Ç –∏ —Ç–≥ 30 %'
            ];
            const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C71585', '#20B2AA', '#FFD700', '#8A2BE2'];
            let startAngle = 0;
            const arc = Math.PI / (segments.length / 2);
            let spinAngleStart = 0;
            let spinTime = 0;
            let spinTimeTotal = 0;
            let spinning = false;
            const chatId = tg.initDataUnsafe.user.id;  // –ü–æ–ª—É—á–µ–Ω–∏–µ chat_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

            function drawSegment(index, angle, arc, centerX, centerY, outerRadius) {
                ctx.fillStyle = colors[index];

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, outerRadius, angle, angle + arc, false);
                ctx.lineTo(centerX, centerY);
                ctx.fill();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(angle + arc / 2 + Math.PI / 2);

                ctx.textAlign = "center";
                ctx.fillStyle = "white";
                ctx.font = 'bold 28px Helvetica, Arial';
                ctx.fillText(segments[index], 0, -outerRadius + 50);
                ctx.restore();
            }

            function drawRouletteWheel() {
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const outerRadius = Math.min(canvas.width, canvas.height) / 2 - 10;
                const borderWidth = 10;

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Draw the outer border
                ctx.beginPath();
                ctx.arc(centerX, centerY, outerRadius + borderWidth, 0, 2 * Math.PI, false);
                ctx.fillStyle = 'white';
                ctx.fill();

                // Draw the segments
                for (let i = 0; i < segments.length; i++) {
                    const angle = startAngle + i * arc;
                    drawSegment(i, angle, arc, centerX, centerY, outerRadius);
                }
            }

            function rotateWheel() {
                spinTime += 30;
                if (spinTime >= spinTimeTotal) {
                    stopRotateWheel();
                    return;
                }
                const spinAngle = easeOutCubic(spinTime, 0, spinAngleStart, spinTimeTotal);
                startAngle += (spinAngle * Math.PI / 180);
                drawRouletteWheel();
                requestAnimationFrame(rotateWheel);
            }

            function stopRotateWheel() {
                const degrees = startAngle * 180 / Math.PI + 90;
                const arcd = arc * 180 / Math.PI;
                const index = Math.floor((360 - degrees % 360) / arcd);
                const text = segments[index];
                const description = descriptions[index];
                const resultBox = document.getElementById('resultBox');
                resultBox.innerText = `${text} - ${description}`;
                resultBox.style.display = 'flex';
                sendMessageToServer(`${text} - ${description}`);
                spinning = false;
                document.getElementById('spinButton').disabled = false;
            }

            function easeOutCubic(t, b, c, d) {
                t /= d;
                t--;
                return c * (t * t * t + 1) + b;
            }

            function easeInQuad(t, b, c, d) {
                t /= d;
                return c * t * t + b;
            }

            function spinWheel() {
                if (spinning) return;
                spinning = true;
                spinAngleStart = (Math.random() * 10 + 10) * 2;
                spinTime = 0;
                spinTimeTotal = (Math.random() * 10 + 20) * 1000;

                let accelerationTime = spinTimeTotal / 4;
                let decelerationTime = spinTimeTotal - accelerationTime;

                function accelerateWheel() {
                    spinTime += 30;
                    if (spinTime >= accelerationTime) {
                        spinTime = accelerationTime;
                        requestAnimationFrame(decelerateWheel);
                        return;
                    }
                    const spinAngle = easeInQuad(spinTime, 0, spinAngleStart, accelerationTime);
                    startAngle += (spinAngle * Math.PI / 180);
                    drawRouletteWheel();
                    requestAnimationFrame(accelerateWheel);
                }

                function decelerateWheel() {
                    spinTime += 30;
                    if (spinTime >= spinTimeTotal) {
                        stopRotateWheel();
                        return;
                    }
                    const spinAngle = easeOutCubic(spinTime - accelerationTime, spinAngleStart, -spinAngleStart, decelerationTime);
                    startAngle += (spinAngle * Math.PI / 180);
                    drawRouletteWheel();
                    requestAnimationFrame(decelerateWheel);
                }

                requestAnimationFrame(accelerateWheel);
            }

            function applyTheme(themeParams) {
                document.documentElement.style.setProperty('--background-color', themeParams.bg_color);
                drawRouletteWheel();
            }

            function sendMessageToServer(message) {
                fetch('http://localhost:5000/send_message', { // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message, chat_id: chatId }),
                }).then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            }

            function init() {
                tg.ready();
                drawRouletteWheel();
                applyTheme(tg.themeParams);
                document.getElementById("spinButton").addEventListener("click", () => {
                    document.getElementById('resultBox').style.display = 'none';
                    spinWheel();
                });
                tg.onEvent('themeChanged', () => applyTheme(tg.themeParams));
            }

            init();
        });
    </script>
</body>
</html>
